<!doctype html>

<html lang="en">
<head>
  <script src="http://code.jquery.com/jquery-latest.min.js"
      type="text/JavaScript">
    </script>
  <meta charset="utf-8">

  <title>Hello World</title>
  <meta name="description" content="Hello World">
  <meta name="author" content="SitePoint">

  <script type="text/JavaScript" language="JavaScript">
  //Get inContact Token
  var accessToken = '';
  var baseURI = '';

  function getToken() {
      var url_base =
         'https://api.incontact.com/InContactAuthorizationServer/Token';

      // The auth_token is the base64 encoded string for the API
      // application.
      var auth_token = 'TestApp@Inova:4593906';
      auth_token = window.btoa(auth_token);
      var requestPayload = {
          // Enter your inContact credentials for the 'username' and
          // 'password' fields.
          'grant_type': 'password',
          'username': 'nlitton@inovasolutions.com',
          'password': '7cXuNNehox1g',
          'scope': ''
      }
      $.ajax({
          'url': url_base,
          'type': 'POST',
          'content-Type': 'x-www-form-urlencoded',
          'dataType': 'json',
          'headers': {
            // Use access_token previously retrieved from inContact token
            // service.
            'Authorization': 'basic ' + auth_token
          },
          'data': requestPayload,
          'success': function (result) {
            //Process success actions
            accessToken = result.access_token;
            baseURI = result.resource_server_base_uri;
            getServerTime();
            return result;
          },
          'error': function (XMLHttpRequest, textStatus, errorThrown) {
            //Process error actions
            alert('Error: ' + errorThrown);
            console.log(XMLHttpRequest.status + ' ' +
                XMLHttpRequest.statusText);
            return false;
          }
      });
    }

  function display_c(){
    var refresh=10000; // Refresh rate in milli seconds
    mytime=setTimeout('getServerTime()',refresh)
  }

  // BU Agents List
  function getServerTime() {
      // The baseURI variable is created by the result.base_server_base_uri
      // which is returned when getting a token and should be used to
      // create the url_base.
      var url_base = baseURI;
      $.ajax({
          'url': url_base + '/services/v4.0/server-time',
          'type': 'GET',
          'content-Type': 'x-www-form-urlencoded',
          'dataType': 'json',
          'headers': {
            // Use access_token previously retrieved from inContact token
            // service.
            'Authorization': 'bearer ' + accessToken
          },
          'success': function (result) {
            //Process success actions
            var returnResult = JSON.stringify(result);
            document.getElementById('callResults').innerHTML = returnResult;
            return result;
          },
          'error': function (XMLHttpRequest, textStatus, errorThrown) {
            //Process error actions
            alert('Error: ' + errorThrown);
            console.log(XMLHttpRequest.status + ' ' +
                XMLHttpRequest.statusText);
            return false;
          }
      });
      tt=display_c();
  }


  </script>
    <![endif]-->
    <style>
          .outer {
              width: 960px;
              min-height: 45px;
              height: auto;
              color: black;
              background-color: lightgray;
              border: 1px solid black;
              padding: 5px;
              word-wrap: break-word;
          }
      </style>
</head>

<body onload="getToken()">
     <!-- List of Agents within a BU -->
     <!-- Make sure to update the "button onclick" with the method being
            tested -->
     <br />Results:
     <br />
     <div class="outer" id="callResults"></div>
  </body>
</html>